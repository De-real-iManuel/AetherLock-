# =============================================================================
# AetherLock Backend Environment Configuration
# =============================================================================
# This file contains all required environment variables for the backend service.
# Copy this file to .env and fill in your actual values.
# NEVER commit the .env file to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
# Port for the backend server (default: 3001)
PORT=3001

# Node environment (development, production, test)
NODE_ENV=development

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# PostgreSQL connection string for production (Railway provides this automatically)
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA&sslmode=require
# Example: postgresql://aetherlock:securepass@db.example.com:5432/aetherlock?schema=public&sslmode=require
# Railway: Use the DATABASE_URL from Railway's PostgreSQL plugin (automatically injected)
DATABASE_URL="postgresql://user:password@localhost:5432/aetherlock?schema=public&sslmode=require"

# For development with SQLite (no setup required)
# DATABASE_URL="file:./dev.db"

# Database connection pool settings (for production)
# These settings optimize database connections for high-traffic production environments
# Note: Prisma uses these values internally for connection management
# Min connections: Minimum number of connections to maintain in the pool
DATABASE_POOL_MIN=2
# Max connections: Maximum number of connections allowed in the pool
# Railway PostgreSQL Starter: 22 connections max, keep this at 10 to leave headroom
# Railway PostgreSQL Pro: 100+ connections, can increase to 20-50
DATABASE_POOL_MAX=10
# Connection timeout: Maximum time (ms) to wait for a connection from the pool
DATABASE_CONNECTION_TIMEOUT=30000
# Connection lifetime: Maximum time (ms) a connection can be reused (prevents stale connections)
DATABASE_CONNECTION_LIFETIME=1800000
# Idle timeout: Time (ms) before an idle connection is closed
DATABASE_IDLE_TIMEOUT=600000

# Direct database URL (optional, only needed for external connection poolers like PgBouncer)
# DATABASE_DIRECT_URL="postgresql://user:password@localhost:5432/aetherlock?schema=public&sslmode=require"

# -----------------------------------------------------------------------------
# Frontend URL Configuration
# -----------------------------------------------------------------------------
# Frontend URL for CORS configuration
# Development: http://localhost:5173
# Production: https://your-app.vercel.app (replace with your actual Vercel domain)
# IMPORTANT: Update this with your production Vercel URL after deployment
FRONTEND_URL=http://localhost:5173

# Additional allowed origins (comma-separated, optional)
# Use this to allow multiple frontend domains (e.g., www and non-www versions)
# Example: https://aetherlock.app,https://www.aetherlock.app
ADDITIONAL_CORS_ORIGINS=

# Backend URL (used for webhooks and callbacks)
# Development: http://localhost:3001
# Production: Railway provides this automatically as RAILWAY_PUBLIC_DOMAIN
# Format: https://your-app.up.railway.app
BACKEND_URL=http://localhost:3001

# -----------------------------------------------------------------------------
# AI Verification Service (Gemini API)
# -----------------------------------------------------------------------------
# Google Gemini API key for AI-powered work verification
# Get your API key from: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=your_gemini_api_key_here

# AI model configuration
AI_MODEL=gemini-1.5-flash
AI_MAX_TOKENS=2048
AI_TEMPERATURE=0.7

# -----------------------------------------------------------------------------
# Identity Verification (zkMe KYC)
# -----------------------------------------------------------------------------
# zkMe API credentials for identity verification
# Get your credentials from: https://zk.me/
ZKME_API_KEY=your_zkme_api_key_here
ZKME_APP_ID=your_zkme_app_id_here

# zkMe webhook secret for verifying webhook signatures
ZKME_WEBHOOK_SECRET=your_zkme_webhook_secret_here

# -----------------------------------------------------------------------------
# IPFS Storage (Pinata)
# -----------------------------------------------------------------------------
# Pinata credentials for decentralized file storage
# Get your credentials from: https://pinata.cloud/
IPFS_API_KEY=your_pinata_api_key_here
IPFS_API_SECRET=your_pinata_api_secret_here
IPFS_JWT=your_pinata_jwt_token_here

# Pinata gateway URL for retrieving files
IPFS_GATEWAY_URL=https://gateway.pinata.cloud

# -----------------------------------------------------------------------------
# Blockchain Configuration - Solana
# -----------------------------------------------------------------------------
# Solana program ID for escrow smart contract
SOLANA_PROGRAM_ID=your_solana_program_id_here

# Solana RPC endpoint
# Devnet: https://api.devnet.solana.com
# Mainnet: https://api.mainnet-beta.solana.com or use a dedicated RPC provider
SOLANA_RPC_URL=https://api.devnet.solana.com

# Solana network (devnet, testnet, mainnet-beta)
SOLANA_NETWORK=devnet

# -----------------------------------------------------------------------------
# Blockchain Configuration - Sui
# -----------------------------------------------------------------------------
# Sui package ID for escrow smart contract
SUI_PACKAGE_ID=your_sui_package_id_here

# Sui RPC endpoint
# Devnet: https://fullnode.devnet.sui.io
# Mainnet: https://fullnode.mainnet.sui.io
SUI_RPC_URL=https://fullnode.devnet.sui.io

# Sui network (devnet, testnet, mainnet)
SUI_NETWORK=devnet

# -----------------------------------------------------------------------------
# Blockchain Configuration - TON
# -----------------------------------------------------------------------------
# TON contract address for escrow smart contract
TON_CONTRACT_ADDRESS=your_ton_contract_address_here

# TON API endpoint
TON_API_URL=https://testnet.toncenter.com/api/v2

# TON network (testnet, mainnet)
TON_NETWORK=testnet

# -----------------------------------------------------------------------------
# Blockchain Configuration - ZetaChain
# -----------------------------------------------------------------------------
# ZetaChain RPC URL
# Athens Testnet: https://zetachain-athens-evm.blockpi.network/v1/rpc/public
# Mainnet: https://zetachain-evm.blockpi.network/v1/rpc/public
ZETACHAIN_RPC_URL=https://zetachain-athens-evm.blockpi.network/v1/rpc/public

# ZetaChain private key (for signing transactions)
# IMPORTANT: Use a dedicated wallet for the backend, NOT your personal wallet!
# Generate a new wallet and fund it with testnet tokens
ZETACHAIN_PRIVATE_KEY=your_zetachain_private_key_here

# ZetaChain contract addresses
ZETACHAIN_GATEWAY_ADDRESS=0x6c533f7fe93fae114d0954697069df33c9b74fd7
ZETACHAIN_ZRC20_ADDRESS=0x5F0b1a82749cb4E2278EC87F8BF6B618dC71a8bf

# ZetaChain network (athens-testnet, mainnet)
ZETACHAIN_NETWORK=athens-testnet

# -----------------------------------------------------------------------------
# Treasury Configuration
# -----------------------------------------------------------------------------
# AetherLock treasury wallet address for collecting platform fees
AETHERLOCK_TREASURY_WALLET=your_treasury_wallet_address_here

# Platform fee percentage (e.g., 2.5 for 2.5%)
PLATFORM_FEE_PERCENTAGE=2.5

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------
# JWT secret for authentication tokens (generate a strong random string)
JWT_SECRET=your_jwt_secret_here_use_a_long_random_string

# JWT expiration time (e.g., 7d, 24h, 30m)
JWT_EXPIRATION=7d

# Rate limiting configuration
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# CORS allowed origins (comma-separated list)
# Development: http://localhost:5173,http://localhost:3000
# Production: https://aetherlock.vercel.app,https://www.aetherlock.app
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# -----------------------------------------------------------------------------
# Logging and Monitoring
# -----------------------------------------------------------------------------
# Log level (error, warn, info, debug)
# Production: Use 'info' or 'warn' to reduce log volume
# Development: Use 'debug' for detailed logging
LOG_LEVEL=info

# Enable request logging (true/false)
# Production: Set to 'true' for monitoring, 'false' to reduce log volume
# Logs include: method, path, status code, response time
ENABLE_REQUEST_LOGGING=true

# Enable detailed error logging (true/false)
# Production: Set to 'false' to prevent sensitive data leakage
# Development: Set to 'true' for debugging
ENABLE_ERROR_STACK_TRACES=false

# Sentry DSN for error tracking (optional but recommended for production)
# Get your DSN from: https://sentry.io/
# Sentry captures errors, performance metrics, and user feedback
SENTRY_DSN=

# Sentry environment name (development, staging, production)
SENTRY_ENVIRONMENT=production

# Sentry sample rate for performance monitoring (0.0 to 1.0)
# 0.1 = 10% of transactions, 1.0 = 100% of transactions
SENTRY_TRACES_SAMPLE_RATE=0.1

# Enable performance monitoring (true/false)
ENABLE_PERFORMANCE_MONITORING=true

# Log format (json, text)
# Production: Use 'json' for structured logging and easier parsing
# Development: Use 'text' for human-readable logs
LOG_FORMAT=json

# -----------------------------------------------------------------------------
# WebSocket Configuration
# -----------------------------------------------------------------------------
# WebSocket connection settings
WS_PING_INTERVAL=25000
WS_PING_TIMEOUT=60000
WS_MAX_CONNECTIONS_PER_USER=5

# -----------------------------------------------------------------------------
# Email Configuration (Optional)
# -----------------------------------------------------------------------------
# SMTP settings for sending notification emails
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password_here

# Email sender information
EMAIL_FROM_NAME=AetherLock
EMAIL_FROM_ADDRESS=noreply@aetherlock.app

# -----------------------------------------------------------------------------
# Redis Configuration (Optional - for caching and session management)
# -----------------------------------------------------------------------------
# Redis connection URL
# Format: redis://username:password@host:port
REDIS_URL=redis://localhost:6379

# Redis key prefix
REDIS_KEY_PREFIX=aetherlock:

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
# Enable/disable specific features
ENABLE_AI_VERIFICATION=true
ENABLE_KYC_VERIFICATION=true
ENABLE_CROSS_CHAIN=true
ENABLE_CHAT=true
ENABLE_NOTIFICATIONS=true

# -----------------------------------------------------------------------------
# Development/Testing Configuration
# -----------------------------------------------------------------------------
# Skip authentication in development (NOT for production!)
SKIP_AUTH=false

# Mock external services in development
MOCK_AI_SERVICE=false
MOCK_IPFS_SERVICE=false
MOCK_BLOCKCHAIN_SERVICE=false

# -----------------------------------------------------------------------------
# Production Deployment Notes
# -----------------------------------------------------------------------------
# For Railway deployment:
# 
# 1. DATABASE CONFIGURATION:
#    - Add PostgreSQL plugin in Railway dashboard
#    - DATABASE_URL is automatically injected by Railway
#    - Ensure connection string includes ?sslmode=require for security
#    - Configure connection pool settings (DATABASE_POOL_MAX=10 for Starter plan)
# 
# 2. ENVIRONMENT VARIABLES:
#    - Set NODE_ENV=production
#    - Set FRONTEND_URL to your Vercel deployment URL (e.g., https://your-app.vercel.app)
#    - Generate strong JWT_SECRET (use: openssl rand -base64 32)
#    - Configure all API keys (GEMINI_API_KEY, ZKME_API_KEY, IPFS_JWT, etc.)
#    - Set CORS_ALLOWED_ORIGINS with production domains
#    - Set LOG_LEVEL=info or warn
#    - Set ENABLE_ERROR_STACK_TRACES=false
#    - Set LOG_FORMAT=json
# 
# 3. HEALTH CHECK:
#    - Railway health check endpoint: GET /health
#    - Health check path: /health
#    - Health check interval: 30 seconds
#    - Health check timeout: 10 seconds
#    - Health check retries: 3
# 
# 4. DEPLOYMENT SETTINGS:
#    - Enable automatic deployments from GitHub main branch
#    - Set build command: npm install && npm run db:generate
#    - Set start command: npm start
#    - Configure custom domain (optional)
# 
# 5. MONITORING:
#    - Enable Railway metrics dashboard
#    - Set up Sentry for error tracking (optional but recommended)
#    - Monitor database connection pool usage
#    - Set up alerts for high error rates
# 
# 6. SECURITY:
#    - Ensure all secrets are stored in Railway environment variables
#    - Never commit .env file to version control
#    - Use strong passwords and API keys
#    - Enable SSL for all external connections
#    - Configure rate limiting (RATE_LIMIT_MAX_REQUESTS=100)
# 
# 7. PERFORMANCE:
#    - Enable connection pooling (DATABASE_POOL_MAX=10)
#    - Configure WebSocket settings (WS_MAX_CONNECTIONS_PER_USER=5)
#    - Enable request compression (handled by Express)
#    - Use CDN for static assets (if applicable)
# 
# 8. CORS CONFIGURATION:
#    - Add production frontend URL to CORS_ALLOWED_ORIGINS
#    - Format: https://your-app.vercel.app,https://www.your-app.com
#    - Do not include trailing slashes
#    - Test CORS configuration after deployment
# 
# 9. DATABASE MIGRATIONS:
#    - Run migrations before deployment: npm run db:migrate
#    - Or use: npx prisma migrate deploy (for production)
#    - Backup database before running migrations
# 
# 10. POST-DEPLOYMENT CHECKLIST:
#     - Test health check endpoint: curl https://your-app.up.railway.app/health
#     - Verify database connection
#     - Test API endpoints
#     - Verify WebSocket connections
#     - Check CORS configuration
#     - Monitor error logs for first 24 hours
#     - Test all integrations (AI, IPFS, zkMe, blockchain)
# -----------------------------------------------------------------------------
